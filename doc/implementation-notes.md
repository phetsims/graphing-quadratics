# Graphing Quadratics - implementation notes

This document contains notes related to the implementation of Graphing Quadratic. This is not an exhaustive description
of the implementation. The intention is to provide a high-level overview, and to supplement the internal documentation (
source code comments) and external documentation (design document).

The audience for this document is software developers who are familiar with JavaScript and PhET simulation development,
as described
in [PhET Development Overview](https://github.com/phetsims/phet-info/blob/main/doc/phet-development-overview.md). The
reader should also be familiar with general design patterns used in PhET simulations.

Before reading this document, see [model.md](https://github.com/phetsims/graphing-quadratics/blob/main/doc/model.md),
which provides a high-level description of the simulation model.

You may also wish to review
the [Graphing Quadratics design document](https://docs.google.com/document/d/1wgxqGIhs37BLamT2Kpqnm1pswbrM4i6Hd9edGy3bNCg/edit),
but be forewarned that it is out of date.

## Terminology

This section defines terminology that you'll see used throughout the internal and external documentation. There's no
need to memorize this section; skim it once, refer back to it as you explore the implementation.

Standard terminology:

* axis of symmetry - vertical line that intersects the vertex
* constant term - the _c_ term of _y_ = _ax_<sup>2</sup> + _bx_ + _c_
* curve - generalization of a line, whose curvature need not be zero (geometric definition)
* directrix - a fixed horizontal line used in describing a curve or surface
* focus - a fixed point on the interior of a parabola, used in the formal definition of the curve
* line - a straight curve (geometric definition)
* linear term - the _bx_ term of _y_ = _ax_<sup>2</sup> + _bx_ + _c_
* parabola - a plane curve generated by a point moving so that its distance from a fixed point (focus) is equal to its
  distance from a fixed line (directrix)
* quadratic - short for "quadratic equation", in any of the [3 supported forms](https://github.com/phetsims/graphing-quadratics/blob/main/doc/model.md)
* quadratic term - the _ax_<sup>2</sup> term of _y_ = _ax_<sup>2</sup> + _bx_ + _c_
* roots (or real roots) - zero or more point(s) where a polynomial intersects the x axis
* standard form - see [model.md](https://github.com/phetsims/graphing-quadratics/blob/main/doc/model.md)
* vertex - the highest or lowest point of a parabola, also it's turning point
* vertex form - see [model.md](https://github.com/phetsims/graphing-quadratics/blob/main/doc/model.md)

PhET-specific terminology:

* alternative vertex form - see [model.md](https://github.com/phetsims/graphing-quadratics/blob/main/doc/model.md)
* erase button - button with an eraser icon, used to erase the saved curve
* graph contents - everything that is displayed on the graph, excluding the grid and axes
* 'hide graph contents' button - button with an eyeball icon that shows/hides the graph contents
* interactive quadratic - the quadratic that the user can interact with, via sliders, spinners, and/or manipulators
* manipulator - shaded sphere that appears on the graph, used to change some aspect of the interactive quadratic
* saved curve - the saved state of the interactive quadratic, appears on the graph as a gray parabola or line
* save button - button with a camera icon, used to create the saved curve

## Common Patterns

This section describes how this simulation uses patterns that are common to PhET simulations.

**Model-view transform**: This simulation has a model-view transform that maps from the graph (model) coordinate frame
to the view coordinate frame. The origin (0,0) in the model coordinate frame is (not surprisingly) at the origin of the
graph.

**Query parameters**: Query parameters are used to enable sim-specific features, mainly for debugging and testing.
Sim-specific query parameters are documented in
[GQQueryParameters](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/GQQueryParameters.ts).

**Assertions**: The implementation makes liberal use of `affirm` to verify pre/post assumptions and perform argument
validation. If you are making modifications to this sim, do so with assertions enabled via the `ea` query parameter.

**Memory management**: `isDisposable: false` is used to identify classes that do not support `dispose`. Unless otherwise
documented in the source code, assume that `unlink`, `removeListener`, `dispose`, etc. are generally not needed. Most object 
instances exist for the lifetime of the sim. The exception is `QuadraticNode` for the saved curve.

## Related simulations

This sim reuses a small amount of code from the **Graphing Lines** simulation. Search for "graphing-lines/" to identify what is reused.

## Model

This section provides an overview of the most important model components.

Note that this simulation supports _only_ parabolas that open up or down, i.e. have the form _y_ = _ax_<sup>2</sup> +
_bx_ + _c_. It does not support parabolas that open left or right, i.e. that have the form _x_ = _ay_<sup>2</sup> +
_by_ + _c_.

[Quadratic](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/model/Quadratic.ts) is the primary model
component. It is an immutable data structure that describes a quadratic equation. It supports instantiation
using standard form (via the constructor), vertex form (via `createFromVertexForm`) and alternate vertex form (
via `createFromAlternateVertexForm`).

[GQModel](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/model/GQModel.ts) is the base class for the top-level model in all screens,
and includes the model components that are common to all screens. Each screen has a subclass of `GQModel` that adds things that are specific to that screen.
For example, [ExploreModel](https://github.com/phetsims/graphing-quadratics/blob/main/js/explore/model/ExploreModel.ts) is
the model container for the _Explore_ screen.

## View

This section provides an overview of the most important view components.

[QuadraticNode](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/QuadraticNode.ts) is the
primary view component, responsible for rendering the curve that corresponds to a `Quadratic` instance, and labeling the
curve with an equation. While `QuadraticNode` is responsible for the placement of the equation relative to the
curve, [GQEquationFactory](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/GQEquationFactory.ts)
is responsible for creation of equations.

[GQScreenView](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/GQScreenView.ts) is the base
class for all ScreenViews in this sim. It includes the view components that are common to all screens, and it handles
common layout responsibilities. Each screen has a subclass of `GQScreenView` that adds things that are specific to that
screen. For
example, [ExploreScreenView](https://github.com/phetsims/graphing-quadratics/blob/main/js/explore/view/ExploreScreenView.ts)
is the view for the _Explore_ screen.

[GQGraphNode](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/GQGraphNode.ts) is the base class
for all graphs in this sim. Each screen has a subclass of `GQGraphNode` that adds things that are specific to that
screen. For
example, [ExploreGraphNode](https://github.com/phetsims/graphing-quadratics/blob/main/js/explore/view/ExploreGraphNode.ts)
is the graph for the _Explore_ screen.

[GQEquationAccordionBox](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/GQEquationAccordionBox.ts)
is the base class for the accordion box that displays the interactive quadratic. Each screen has a subclass of
EquationAccordionBox that adds things that are specific to that screen. (Do you see a pattern here? :wink:) For
example, [ExploreEquationAccordionBox](https://github.com/phetsims/graphing-quadratics/blob/main/js/explore/view/ExploreEquationAccordionBox.ts)
is the equation accordion box for the _Explore_ screen.

Each screen has a class whose name ends with "InteractiveEquationNode", for
example, [ExploreInteractiveEquationNode](https://github.com/phetsims/graphing-quadratics/blob/main/js/explore/view/ExploreInteractiveEquationNode.ts).
This is the UI for modifying the interactive quadratic _indirectly_, using sliders or spinners. _Explore_ and _Focus &
Directrix_ screens use sliders, _Standard Form_ and _Vertex Form_ screens use spinners.

Manipulators are the shaded spheres that appear on the graph. They allow the user to modify the interactive quadratic
_directly_, by interacting with its curve.
See [GQManipulator](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/GQManipulator.ts) base
class and its 3 subclasses, [VertexManipulator](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/VertexManipulator.ts), [FocusManipulator](https://github.com/phetsims/graphing-quadratics/blob/main/js/focusanddirectrix/view/FocusManipulator.ts)
and [PointOnParabolaManipulator](https://github.com/phetsims/graphing-quadratics/blob/main/js/focusanddirectrix/view/PointOnParabolaManipulator.ts),
for changing the vertex, focus, and point on the parabola, respectively.

## Core Description

The big chunks of code that implement core description can be found in the `view/description/` subdirectories.

The most important classes are:
* [GQEquationDescriber](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/description/GQEquationDescriber.ts) describes mathematical equations.
* [PointToolDescriber](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/description/PointToolDescriber.ts) describes what a point tool is measuring.
* [GQGraphAccessibleListNode](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/description/GQGraphAccessibleListNode.ts) and its subclasses (one per screen) describe what is shown in the Graph Area.
* [GQScreenSummaryContent](https://github.com/phetsims/graphing-quadratics/blob/main/js/common/view/description/GQScreenSummaryContent.ts) and its subclasses (one per screen) describe the Screen summaries.

Smaller pieces of code related to core description can be found by searching for description-related options
(`accessibleName`, `accessibleHelpText`, `accessibleObjectResponse`, `accessibleContextResponse`, ...) and 
the `doAccessibleObjectResponse` method in classes for draggable objects (manipulators and point tools).

## PhET-iO
 
`Quadratic.QuadraticIO` is a custom `IOType` that implements data-type serialization for quadratic equations. 
It is used as the `phetioValueType` for various Properties whose value is of type `Quadratic`.

There are no dynamic PhET-iO elements in this sim, and therefore no uses of `PhetioGroup` or `PhetioCapsule`.
